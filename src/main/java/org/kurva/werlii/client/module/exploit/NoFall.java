package org.kurva.werlii.client.module.exploit;

import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.text.Text;
import org.kurva.werlii.client.module.Module;
import org.kurva.werlii.client.setting.ModeSetting;
import org.lwjgl.glfw.GLFW;

public class NoFall extends Module {
    private final ModeSetting modeS;
    
    public NoFall() {
        super("NoFall", "Prevents fall damage", Category.EXPLOIT);
        this.setKeyCode(GLFW.GLFW_KEY_N);
        this.registerKeybinding("Werlii Exploit");
        
        modeS = new ModeSetting("Mode", "Method to prevent fall damage", this, "Packet", "Packet", "Ground", "Bounce", "Anti-Kick");
        
        addSetting(modeS);
        
    }
    
    @Override
    public void onEnable() {
        super.onEnable();
        
        if (mc != null && mc.player != null && !mc.isInSingleplayer()) {
            mc.player.sendMessage(Text.literal("§8[§bWerlii§8] §cWarning: NoFall may cause server kicks or bans."), false);
        }
    }
    
    @Override
    public void onTick() {
        if (mc.player == null || mc.world == null) return;
        
        if (mc.player.getVelocity().y < -0.5) {
            switch (modeS.getValue()) {
                case "Packet":
                    mc.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.OnGroundOnly(true));
                    break;
                    
                case "Ground":
                    mc.player.setOnGround(true);
                    break;
                    
                case "Bounce":
                    if (mc.player.fallDistance > 3 && !mc.player.isOnGround()) {
                        mc.player.setVelocity(mc.player.getVelocity().x, 0.1, mc.player.getVelocity().z);
                        mc.player.fallDistance = 0;
                    }
                    break;
                    
                case "Anti-Kick":
                    if (mc.player.fallDistance > 3) {
                        mc.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.OnGroundOnly(true));
                        mc.player.fallDistance = 0;
                    }
                    break;
            }
        }
    }
}

